<!DOCTYPE html> <html lang=en > <meta charset=UTF-8 > <title></title> <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/PDE/css/franklin.css"> <link rel=stylesheet  href="/PDE/css/tufte.css"> <link rel=stylesheet  href="/PDE/css/adjust.css"> <link rel=stylesheet  href="/PDE/css/latex.css"> <link rel=stylesheet  href="/PDE/css/weave.css"> <style> </style> <script> window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } }; </script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script> <div class=franklin-content > <ul> <li><p><a href="/PDE/weave/lab07/Poisson_example.ipynb">Click here to download this notebook</a></p> </ul> <h2>Example of approximations to the Poisson problem with different boundary conditions</h2> <p>The problem to solve is: </p> <p>\begin&#123;align&#125; -\Delta u &amp;&#61; f \;\;\;\;\; \text&#123;in &#125; \Omega \ u &amp;&#61; g \;\;\;\;\; \text&#123;in &#125; \partial \Omega<em>&#123;int&#125; \ \hat&#123;n&#125; \cdot \nabla u &amp;&#61; h \;\;\;\;\; \text&#123;in &#125; \partial \Omega</em>&#123;ext&#125; \ \end&#123;align&#125;</p> <p>For that we impose the weak version of it:</p> <p>Find <span class=math >$u$</span> in <span class=math >$V = H^1(\Omega, f) \cap H^1_0(\Omega, \partial \Omega_{int})$</span> &#40;that is with elements vanishing at <span class=math >$\partial \Omega_{int}$</span>&#41; such that:,</p> <p class=math >\[ \int_{\Omega} \nabla v \cdot \nabla u \; d\Omega - \int_{\Omega} v \; f \; d\Omega - \oint_{\partial \Omega_{ext}} v \; h \; d\Gamma = 0 \;\;\;\;\; \forall v \;\; \in V \]</p> <p>If we obtain a solution <span class=math >$u$</span> and it is sufficiently smooth, we can integrate by parts the first term and obtain: </p> <p class=math >\[ \int_{\Omega} v \; (-\Delta u - f) \; d\Omega + \oint_{\partial \Omega_{ext}} v \; (\hat{n} \cdot \nabla u - h) \; d\Gamma = 0 \;\;\;\;\; \forall v \;\; \in V \]</p> <p>Taking <span class=math >$v$</span> arbitrary but of compact support inside <span class=math >$Ω$</span> we see that <span class=math >$u$</span> must satisfy:</p> <p class=math >\[ -\Delta u = f \;\;\;\;\; \text{in } \Omega, \]</p> <p>taking now <span class=math >$v$</span> arbitrary but different from zero in a neighborhood of the exterior boundary, we see that it must satisfy also the Neumann condition:</p> <p class=math >\[ \hat{n} \cdot \nabla u = h \;\;\;\;\; \text{in } \partial \Omega_{ext}. \]</p> <p>The Dirichlet condition is automatic for this choice of functional space.</p> <p>To solve the problem we shall use the a Julia package <code>Gridap.jl</code>. This example is a mixture of several examples in the Gridap tutorial.</p> <pre class='hljl'>
<span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>Gridap</span><span class='hljl-t'>
</span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>GridapGmsh</span><span class='hljl-t'>
</span><span class='hljl-cs'>#import Gmsh: gmsh # NEVER use #using Gmsh</span><span class='hljl-t'>
</span><span class='hljl-cs'>#mkdir(&quot;models&quot;)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#mkdir(&quot;images&quot;)</span>
</pre> <pre class='hljl'>
<span class='hljl-n'>plot_s</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span><span class='hljl-t'>
</span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>GridapMakie</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>GLMakie</span><span class='hljl-t'> </span><span class='hljl-cs'>#Para graficar </span><span class='hljl-t'>
    </span><span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>FileIO</span><span class='hljl-t'> </span><span class='hljl-cs'>#Gráficos y salidas</span><span class='hljl-t'>
    </span><span class='hljl-n'>GLMakie</span><span class='hljl-oB'>.</span><span class='hljl-nf'>activate!</span><span class='hljl-p'>(</span><span class='hljl-n'>inline</span><span class='hljl-oB'>=</span><span class='hljl-kc'>true</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-cs'># For windows on the notebook itself. Comment out if you want the as pop-out plots.</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: ArgumentError: Package GridapMakie not found in current path.
- Run &#96;import Pkg; Pkg.add&#40;&quot;GridapMakie&quot;&#41;&#96; to install the GridapMakie package.
</pre> <p>We will use a mesh previously built with the <code>gmsh</code> library. In the <code>models</code> directory you will find a <em>script</em> with the <code>.geo</code> extension &#40;<code>rectangle_hole.geo</code>&#41;, which was used to build the example. Based on this script, and following the <code>gmsh</code> tutorial, you can build different meshes. Other libraries can also be used to build meshes. These are imported into the <strong>Gridap</strong> infrastructure, and with them the triangulation to be used is constructed. Note that in the script, the two boundaries are named: the external &#40;rectangular&#41; one as <code>&quot;ext&quot;</code> and the internal &#40;circle&#41; one as <code>&quot;int&quot;</code>.</p> <pre class='hljl'>
<span class='hljl-cs'>#model = GmshDiscreteModel(&quot;models/rectangle_hole_fine.msh&quot;)</span><span class='hljl-t'>
</span><span class='hljl-n'>model</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>GmshDiscreteModel</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;models/rectangle_hole_coarse.msh&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-cs'>#model = GmshDiscreteModel(&quot;models/rectangle_hole_finer.msh&quot;)</span>
</pre> <pre class=julia-error >
ERROR: Msh file not found: models/rectangle_hole_coarse.msh
</pre> <pre class='hljl'>
<span class='hljl-n'>Ω</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>Triangulation</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;model&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-n'>degree</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-t'>
</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>Measure</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-n'>degree</span><span class='hljl-p'>)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;Ω&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>wireframe!</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>black</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>scatter!</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>marker</span><span class='hljl-oB'>=:</span><span class='hljl-n'>star8</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>markersize</span><span class='hljl-oB'>=</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>color</span><span class='hljl-oB'>=:</span><span class='hljl-n'>blue</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;Ω&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-n'>full_dirichlet</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-t'>
</span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>false</span><span class='hljl-t'>
</span><span class='hljl-cs'>#full_dirichlet = true</span><span class='hljl-t'>
</span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-kc'>true</span>
</pre> <pre class=output >
true
</pre> <p>Once we have the mesh, we begin to define the finite elements that we will use. In this case, we will use Lagrangian elements of <strong>order 1</strong> that will satisfy a Dirichlet condition on the region <span class=math >$\partial \Omega_{int}$</span>. When the mesh is built, this region has been marked as the interior boundary of the rectangle with the <code>tag</code> <code>&quot;int&quot;</code>.</p> <pre class='hljl'>
<span class='hljl-n'>order</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-t'>
</span><span class='hljl-n'>reffe</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>ReferenceFE</span><span class='hljl-p'>(</span><span class='hljl-n'>lagrangian</span><span class='hljl-p'>,</span><span class='hljl-n'>Float64</span><span class='hljl-p'>,</span><span class='hljl-n'>order</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-n'>dirichlet_tags</span><span class='hljl-oB'>=</span><span class='hljl-s'>&quot;int, &quot;</span><span class='hljl-t'> 
</span><span class='hljl-k'>elseif</span><span class='hljl-t'> </span><span class='hljl-n'>full_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-n'>dirichlet_tags</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;int&quot;</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;ext&quot;</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-n'>V</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>TestFESpace</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-n'>reffe</span><span class='hljl-p'>;</span><span class='hljl-n'>conformity</span><span class='hljl-oB'>=:</span><span class='hljl-n'>H1</span><span class='hljl-p'>,</span><span class='hljl-n'>dirichlet_tags</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>dirichlet_tags</span><span class='hljl-p'>)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;model&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <p>In this example, we are going to test our code using a <em>solution</em> given by the function <span class=math >$u_e(x,y) = 4((x-x_0)^2 - (y-y_0)^3) - 5y$</span>.</p> <p>Thus, <span class=math >$\Delta u_e = -f = 8 - 24(y-y0)$</span> and the Neumann condition will be given by <span class=math >$h = \hat{n} \cdot \nabla u_e$</span>.</p> <pre class='hljl'>
<span class='hljl-n'>x0</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.5</span><span class='hljl-t'>
</span><span class='hljl-n'>y0</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nfB'>0.5</span><span class='hljl-t'>
</span><span class='hljl-nf'>ue</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>4</span><span class='hljl-oB'>*</span><span class='hljl-p'>((</span><span class='hljl-n'>x</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>-</span><span class='hljl-n'>x0</span><span class='hljl-p'>)</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-oB'>-</span><span class='hljl-n'>y0</span><span class='hljl-p'>)</span><span class='hljl-oB'>^</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-nfB'>5.0</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-cs'># &quot;exact solution&quot;</span><span class='hljl-t'>

</span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ue</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>shading</span><span class='hljl-oB'>=</span><span class='hljl-kc'>false</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;Ω&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-cs'># internal Dirichlet boundary condition</span><span class='hljl-t'>
</span><span class='hljl-n'>U</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>TrialFESpace</span><span class='hljl-p'>(</span><span class='hljl-n'>V</span><span class='hljl-p'>,</span><span class='hljl-n'>ue</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>Γ₁</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>BoundaryTriangulation</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-n'>tags</span><span class='hljl-oB'>=</span><span class='hljl-n'>dirichlet_tags</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>n₁</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>get_normal_vector</span><span class='hljl-p'>(</span><span class='hljl-n'>Γ₁</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'>  </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Γ₁</span><span class='hljl-p'>,</span><span class='hljl-n'>ue</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>colormap</span><span class='hljl-oB'>=:</span><span class='hljl-n'>heat</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>10</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;V&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-n'>neumann_tags</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;ext&quot;</span><span class='hljl-t'>
    </span><span class='hljl-cs'>#neumanntags = &quot;int&quot;</span><span class='hljl-t'>
    </span><span class='hljl-n'>Γ</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>BoundaryTriangulation</span><span class='hljl-p'>(</span><span class='hljl-n'>model</span><span class='hljl-p'>,</span><span class='hljl-n'>tags</span><span class='hljl-oB'>=</span><span class='hljl-n'>neumann_tags</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>dΓ</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>Measure</span><span class='hljl-p'>(</span><span class='hljl-n'>Γ</span><span class='hljl-p'>,</span><span class='hljl-n'>degree</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>nb</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>get_normal_vector</span><span class='hljl-p'>(</span><span class='hljl-n'>Γ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;model&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <p>To make sure every thing is OK, we plot the values of <span class=math >$\hat{n}\cdot \nabla u_e$</span> at the external boundary.</p> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'> </span><span class='hljl-oB'>&amp;&amp;</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Γ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>nb</span><span class='hljl-t'> </span><span class='hljl-oB'>⋅</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>ue</span><span class='hljl-p'>)),</span><span class='hljl-t'> </span><span class='hljl-n'>colormap</span><span class='hljl-oB'>=:</span><span class='hljl-n'>algae</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>linewidth</span><span class='hljl-oB'>=</span><span class='hljl-ni'>10</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;nb&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <p>We now define the weak problem in abstract form: </p> <pre class='hljl'>
<span class='hljl-nf'>f</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-nfB'>8.0</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-ni'>24</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-n'>y0</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-cs'># source</span><span class='hljl-t'>
</span><span class='hljl-cs'>#h(x) =  #external Neumann bc.</span><span class='hljl-t'>
</span><span class='hljl-nf'>a</span><span class='hljl-p'>(</span><span class='hljl-n'>u</span><span class='hljl-p'>,</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-oB'>⋅</span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>u</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'>  </span><span class='hljl-cs'>#  in a(u,v) goes all the terms linear in the unknown, u. </span><span class='hljl-t'>
</span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>full_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>b</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>f</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-cs'># </span><span class='hljl-t'>
</span><span class='hljl-k'>elseif</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>b</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>f</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-n'>nb</span><span class='hljl-t'> </span><span class='hljl-oB'>⋅</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>ue</span><span class='hljl-p'>)))</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΓ</span><span class='hljl-t'> </span><span class='hljl-cs'>#  here everything else.</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=output >
b &#40;generic function with 1 method&#41;
</pre> <p>From here the package <strong>Gridap.jl</strong> generates a equation system of the form <span class=math >$Ax=b$</span> and solves it for the finite element version of <span class=math >$u$</span>.</p> <pre class='hljl'>
<span class='hljl-n'>op</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AffineFEOperator</span><span class='hljl-p'>(</span><span class='hljl-n'>a</span><span class='hljl-p'>,</span><span class='hljl-n'>b</span><span class='hljl-p'>,</span><span class='hljl-n'>U</span><span class='hljl-p'>,</span><span class='hljl-n'>V</span><span class='hljl-p'>)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;U&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-n'>ls</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>LUSolver</span><span class='hljl-p'>()</span><span class='hljl-t'>
</span><span class='hljl-n'>solver</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>LinearFESolver</span><span class='hljl-p'>(</span><span class='hljl-n'>ls</span><span class='hljl-p'>)</span>
</pre> <pre class=output >
LinearFESolver&#40;&#41;
</pre> <pre class='hljl'>
<span class='hljl-n'>uh</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>solve</span><span class='hljl-p'>(</span><span class='hljl-n'>solver</span><span class='hljl-p'>,</span><span class='hljl-n'>op</span><span class='hljl-p'>)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;op&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>uh</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>shading</span><span class='hljl-oB'>=</span><span class='hljl-n'>NoShading</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;NoShading&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>full_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>writevtk</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;images/solución_dir&quot;</span><span class='hljl-p'>,</span><span class='hljl-n'>cellfields</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;uh_dir&quot;</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-n'>uh</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-k'>elseif</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>writevtk</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;images/solución_newmann&quot;</span><span class='hljl-p'>,</span><span class='hljl-n'>cellfields</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;uh_neu&quot;</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-n'>uh</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;uh&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <p>We now are going to validate our approximation by comparing it with the exact solution. For that we introduce several tools:</p> <pre class='hljl'>
<span class='hljl-n'>e</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>ue</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-n'>uh</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;uh&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>e</span><span class='hljl-t'>
        </span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>shading</span><span class='hljl-oB'>=</span><span class='hljl-n'>NoShading</span><span class='hljl-t'>
        </span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-n'>fig</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;NoShading&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>full_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>writevtk</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;images/error_dir&quot;</span><span class='hljl-p'>,</span><span class='hljl-n'>cellfields</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;e_dir&quot;</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-n'>e</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-k'>elseif</span><span class='hljl-t'> </span><span class='hljl-n'>int_dirichlet</span><span class='hljl-t'>
    </span><span class='hljl-nf'>writevtk</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;images/error_newmann&quot;</span><span class='hljl-p'>,</span><span class='hljl-n'>cellfields</span><span class='hljl-oB'>=</span><span class='hljl-p'>[</span><span class='hljl-s'>&quot;e_neu&quot;</span><span class='hljl-t'> </span><span class='hljl-oB'>=&gt;</span><span class='hljl-t'> </span><span class='hljl-n'>e</span><span class='hljl-p'>])</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;e&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <p>Next we compute the <span class=math >$L^2$</span> and <span class=math >$H^1$</span> norm for the error. </p> <pre class='hljl'>
<span class='hljl-n'>el2</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sqrt</span><span class='hljl-p'>(</span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-n'>e</span><span class='hljl-oB'>*</span><span class='hljl-n'>e</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;l2 error = &quot;</span><span class='hljl-p'>,</span><span class='hljl-n'>el2</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>eh1</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sqrt</span><span class='hljl-p'>(</span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-n'>e</span><span class='hljl-oB'>*</span><span class='hljl-n'>e</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>e</span><span class='hljl-p'>)</span><span class='hljl-oB'>⋅</span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>e</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-n'>uh1</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sqrt</span><span class='hljl-p'>(</span><span class='hljl-nf'>sum</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-nf'>∫</span><span class='hljl-p'>(</span><span class='hljl-t'> </span><span class='hljl-n'>uh</span><span class='hljl-oB'>*</span><span class='hljl-n'>uh</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>uh</span><span class='hljl-p'>)</span><span class='hljl-oB'>⋅</span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>uh</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>dΩ</span><span class='hljl-t'> </span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;h1 error = &quot;</span><span class='hljl-p'>,</span><span class='hljl-so'>eh1/uh1)</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;e&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>
<span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>plot_s</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>ax</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>plot</span><span class='hljl-p'>(</span><span class='hljl-n'>Ω</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>e</span><span class='hljl-p'>)</span><span class='hljl-oB'>⋅</span><span class='hljl-nf'>∇</span><span class='hljl-p'>(</span><span class='hljl-n'>e</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>shading</span><span class='hljl-oB'>=</span><span class='hljl-n'>NoShading</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>ax</span><span class='hljl-oB'>.</span><span class='hljl-n'>aspect</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>AxisAspect</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-nf'>Colorbar</span><span class='hljl-p'>(</span><span class='hljl-n'>fig</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>],</span><span class='hljl-t'> </span><span class='hljl-n'>plt</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>fig</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre> <pre class=julia-error >
ERROR: UndefVarError: &#96;e&#96; not defined in &#96;Main&#96;
Suggestion: check for spelling errors or missing imports.
</pre> <pre class='hljl'>

</pre> <footer> <p> Published from <a href=Poisson_example.ipynb >Poisson_example.ipynb</a> using <a href="http://github.com/JunoLab/Weave.jl">Weave.jl</a> v0.10.12 on 2025-06-17. </p> </footer> </div>